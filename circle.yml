machine:
  node:
    version: 7.5.0
dependencies:
  pre:
    - echo -e "$NPM_USER\n$NPM_PASS\n$NPM_EMAIL" | npm login
  post:
    - bower install
    - NODE_ENV=production lerna bootstrap
  cache_directories:
    - "node_modules"
    - "packages/components/node_modules"
    - "packages/eslint-config-orion/node_modules"
    - "packages/react-playground/node_modules"
    - "packages/scripts/node_modules"
    - "packages/storybook/node_modules"
    - "packages/style/node_modules"
    - "bower_components"
test:
  pre:
    - npm run compile
    - cd packages/storybook && npm start:
        background: true
  override:
    - npm run test-ci
    - npm run gemini
deployment:
  production:
    branch: master
    commands:
      - npm run build
      - npm run copy-package-builds
      - npm run set-marketing-to-root
      - npm run deploy-master
      - lerna publish --canary --yes
  snapshot:
    branch: /.*/
    commands:
      - npm run build
      - npm run copy-package-builds
      - npm run set-marketing-to-root
      - npm run deploy-snapshot
