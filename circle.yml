machine:
  node:
    version: 7.8.0
dependencies:
  pre:
    - echo -e "$NPM_USER\n$NPM_PASS\n$NPM_EMAIL" | npm login
  override:
    - unset NODE_ENV
    - npm install
    - npm run bootstrap
  cache_directories:
    - "node_modules"
    - "package/angular-playground/node_modules"
    - "packages/angular/node_modules"
    - "packages/components/bower_components"
    - "packages/components/node_modules"
    - "packages/design-dsl/node_modules"
    - "packages/hig-playground/node_modules"
    - "packages/marketing-playground/node_modules"
    - "packages/react-hig/node_modules"
    - "packages/react-playground/node_modules"
    - "packages/react/node_modules"
    - "packages/style/node_modules"
test:
  pre:
    - cd packages/hig.web && npm run build
    - npm run test-lib
    - cd packages/react && npm run start-storybook:
        background: true
  override:
    - npm run test-ci
deployment:
  production:
    branch: master
    commands:
      - npm run build
      - npm run deploy-master
      - npm run publish-canary
  snapshot:
    branch: /.*/
    commands:
      - npm run build
      - npm run deploy-snapshot
