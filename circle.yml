machine:
  node:
    version: 6.9.2
  environment:
    NODE_ENV: production # default is test which suppresses errors in lerna
dependencies:
  post:
    - bower install
    - lerna bootstrap
  cache_directories:
    - "node_modules"
    - "packages/components/node_modules"
    - "packages/eslint-config-orion/node_modules"
    - "packages/react-playground/node_modules"
    - "packages/scripts/node_modules"
    - "packages/storybook/node_modules"
    - "packages/style/node_modules"
    - "bower_components"
test:
  pre:
    - npm run compile
    - cd packages/storybook && NODE_ENV=test npm start:
        background: true
    # This sleep is to ensure storybook is running before gemini starts
    - sleep 10
  override:
    - npm run test-ci
    - npm run gemini
deployment:
  production:
    branch: master
    commands:
      - npm run build
      - npm run copy-package-builds
      - npm run set-marketing-to-root
      - npm run deploy-master
  snapshot:
    branch: /.*/
    commands:
      - npm run build
      - npm run copy-package-builds
      - npm run set-marketing-to-root
      - npm run deploy-snapshot
